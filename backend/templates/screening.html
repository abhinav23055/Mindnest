<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MindNest | Assessment Center</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4f7f6a;
            --secondary: #e6f0ec;
            --text: #2f2f2f;
            --bg: #f9faf9;
            --danger: #d9534f;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 40px 20px; }
        
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* Navigation back */
        .back-nav { margin-bottom: 20px; }
        .back-nav a { text-decoration: none; color: var(--primary); font-weight: 600; display: flex; align-items: center; gap: 5px; }

        /* Hero Section */
        .hero { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 40px; }
        h1 { color: var(--primary); font-size: 2.2rem; margin-bottom: 15px; }
        .hero p { color: #666; line-height: 1.6; max-width: 700px; }

        /* Grid Layout */
        .test-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        
        .test-card {
            background: var(--primary);
            color: white;
            padding: 20px;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 0.95rem;
            font-weight: 600;
            text-align: left;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .test-card:hover { transform: translateY(-5px); background: #3d6353; box-shadow: 0 8px 15px rgba(0,0,0,0.15); }
        .plus-icon { font-size: 1.4rem; opacity: 0.8; }

        /* Quiz Overlay */
        #quizOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
        .quiz-modal { background: white; width: 95%; max-width: 650px; padding: 35px; border-radius: 25px; max-height: 85vh; overflow-y: auto; position: relative; }
        
        .opt-btn { width: 100%; text-align: left; padding: 14px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; background: white; cursor: pointer; transition: 0.2s; font-size: 15px; }
        .opt-btn:hover { background: var(--secondary); border-color: var(--primary); }
        
        .close-btn { position: sticky; top: 0; float: right; cursor: pointer; color: #888; font-weight: bold; background: white; padding: 5px; border-radius: 50%; }
        
        /* Results Style */
        .report-box { padding: 25px; border: 2px solid var(--primary); border-radius: 20px; background: white; margin-top: 20px; }

        @media print {
            body * { visibility: hidden; }
            #pdfContent, #pdfContent * { visibility: visible; }
            #pdfContent { position: absolute; left: 0; top: 0; width: 100%; border: none !important; }
            .no-print { display: none !important; }
        }

        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div class="back-nav">
        <a href="/dashboard">‚Üê Back to Dashboard</a>
    </div>

    <div class="hero">
        <h1>Assessment Center</h1>
        <p>Take a confidential screening to better understand your mental health. These tools are <strong>clinically validated</strong> to help you identify symptoms early.</p>
    </div>

    <div class="test-grid">
        <button class="test-card" onclick="openQuiz('Depression')">DEPRESSION <span class="plus-icon">+</span></button>
        <button class="test-card" onclick="openQuiz('Anxiety')">ANXIETY <span class="plus-icon">+</span></button>
        <button class="test-card" onclick="openQuiz('ADHD')">ADHD <span class="plus-icon">+</span></button>
        <button class="test-card" onclick="openQuiz('OCD')">OCD <span class="plus-icon">+</span></button>
        <button class="test-card" onclick="openQuiz('Bipolar')">BIPOLAR <span class="plus-icon">+</span></button>
        <button class="test-card" onclick="openQuiz('Psychosis')">PSYCHOSIS <span class="plus-icon">+</span></button>
        <button class="test-card" onclick="openQuiz('Eating')">EATING DISORDER <span class="plus-icon">+</span></button>
        <button class="test-card" onclick="openQuiz('PTSD')">PTSD <span class="plus-icon">+</span></button>
        <button class="test-card" onclick="openQuiz('Addiction')">ADDICTION <span class="plus-icon">+</span></button>
        <button class="test-card" onclick="openQuiz('SocialAnxiety')">SOCIAL ANXIETY <span class="plus-icon">+</span></button>
        <button class="test-card" onclick="openQuiz('Postpartum')">POSTPARTUM <span class="plus-icon">+</span></button>
        <button class="test-card" onclick="openQuiz('Child')">CHILD WELLNESS <span class="plus-icon">+</span></button>
    </div>
</div>

<div id="quizOverlay">
    <div class="quiz-modal">
        <span class="close-btn" onclick="closeQuiz()">‚úï</span>
        <h2 id="quizTitle" style="color: var(--primary); margin-bottom: 5px;">Test</h2>
        <p style="color: #888; font-size: 13px; margin-bottom: 20px;">Please select the option that best describes you over the last 2 weeks.</p>
        <div id="quizContent"></div>
    </div>
</div>

<script>
    const quizData = {
        'Depression': ["In the past two weeks, how often have you felt sad, low, or empty?", "How often have you lost interest or pleasure in things you usually enjoy?", "How often do you feel tired or low on energy, even without much physical work?", "How often do you have trouble sleeping (sleeping too much or too little)?", "How often do you feel hopeless about the future?", "How often do you feel bad about yourself or feel like you are a failure?", "How often do you find it hard to concentrate on studies, work, or tasks?", "How often do you feel slow, unmotivated, or mentally heavy?", "How often do you feel lonely or disconnected from people?", "How often do negative thoughts interfere with your daily life?"],
        'Anxiety': ["How often have you felt nervous, anxious, or on edge?", "How often do you worry too much about different things, even small ones?", "How often do you find it hard to control your worrying?", "How often do you feel restless or unable to relax?", "How often do you feel tired or exhausted because of worrying?", "How often do you have trouble concentrating because your mind is full of worries?", "How often do you feel irritated or easily annoyed due to stress?", "How often do you feel afraid that something bad might happen?", "How often do you experience physical signs of anxiety (fast heartbeat, etc.)?", "How often does anxiety interfere with your studies, work, or daily life?"],
        'ADHD': ["How often do you find it hard to stay focused on tasks?", "How often do you get easily distracted by sounds or notifications?", "How often do you start tasks but struggle to finish them?", "How often do you forget important things like deadlines or appointments?", "How often do you feel restless or unable to sit still?", "How often do you rush into things without thinking?", "How often do you have trouble organizing your work or routine?", "How often do you avoid tasks that need long mental effort?", "How often do you feel your mind is always racing?", "How often do these focus problems affect your relationships?"],
        'OCD': ["How often do you get unwanted thoughts or images that keep coming back?", "How often do these thoughts make you feel anxious or stressed?", "How often do you feel the need to check things repeatedly (locks, switches)?", "How often do you wash or clean more than necessary?", "How often do you feel you must do actions in a specific way to feel calm?", "How often do you repeat actions or words to reduce anxiety?", "How often do you feel uncomfortable if things are not perfectly arranged?", "How often do you avoid objects because they trigger stressful thoughts?", "How often do you spend a lot of time on these habits?", "How often do these behaviors interfere with your work or life?"],
        'Bipolar': ["How often do you experience big mood changes (high and low)?", "How often do you feel unusually happy or excited for days?", "How often do you feel very sad, empty, or hopeless for days?", "How often do you notice your energy level changes a lot?", "How often do you need very little sleep but still feel full of energy?", "How often do your thoughts race or you talk much more than usual?", "How often do you do things impulsively during high-energy moods?", "How often do you feel too unmotivated to do simple tasks?", "How often do these mood changes affect your relationships?", "How often do people comment that your behavior changes a lot?"],
        'Psychosis': ["How often do you see or sense things others do not notice?", "How often do you feel your thoughts are confused or mixed up?", "How often do you believe others are watching you without proof?", "How often do you find it hard to tell what is real?", "How often do your thoughts feel disconnected?", "How often do you feel your mind is not working the way it used to?", "How often do you lose interest in people and prefer to stay isolated?", "How often do you feel emotionally 'flat' or empty?", "How often do these experiences make it hard to manage daily life?", "How often do other people notice changes in your speech or behavior?"],
        'Eating': ["How often do you worry a lot about your body shape or weight?", "How often do you feel guilty or ashamed after eating?", "How often do you skip meals to control your weight?", "How often do you feel out of control while eating?", "How often do you try to 'make up for eating' with fasting or over-exercise?", "How often do you think about calories or dieting for a large part of the day?", "How often do your eating habits affect your social life?", "How often do you avoid eating in front of others?", "How often do you feel unhappy with your body regardless of what others say?", "How often does your relationship with food feel stressful?"],
        'PTSD': ["How often do you have unwanted memories or nightmares about a scary experience?", "How often do you feel upset when something reminds you of that experience?", "How often do you try to avoid thinking about a painful event from your past?", "How often do you avoid places or people that remind you of it?", "How often do you feel constantly on edge or easily startled?", "How often do you have trouble staying asleep?", "How often do you feel irritable or have sudden emotional reactions?", "How often do you feel distant from people you used to enjoy?", "How often do you have difficulty concentrating because of stressful thoughts?", "How often do these experiences interfere with your daily life?"],
        'Addiction': ["How often do you feel a strong urge to use a substance or repeat a habit?", "How often do you use more or for longer than you planned?", "How often do you try to cut down but find it difficult?", "How often do you plan your day around it?", "How often do you continue even knowing it's harming your health or work?", "How often do you feel restless when you can't do it?", "How often do you neglect responsibilities because of it?", "How often do you hide how much you use or do it?", "How often do you need more than before to feel the same satisfaction?", "How often does this habit cause problems with people around you?"],
        'SocialAnxiety': ["How often do you feel nervous in social situations like group talks?", "How often do you worry that others will judge or criticize you?", "How often do you avoid social events to avoid embarrassment?", "How often do you feel your heart race or hands shake around others?", "How often do you replay social interactions and worry about what you said?", "How often do you find it hard to speak up even when you want to?", "How often do you feel self-conscious about how you look or sound?", "How often do you prefer to stay invisible to avoid attention?", "How often do you avoid presentations or calls because of fear?", "How often does this fear affect your work or relationships?"],
        'Postpartum': ["How often have you felt sad or empty since the baby was born?", "How often do you cry easily or feel overwhelmed for no clear reason?", "How often do you feel exhausted even when you get some rest?", "How often do you feel hopeless?", "How often do you lose interest in things you used to enjoy?", "How often do you feel guilty or feel like you are not a good enough mother?", "How often do you feel panicky about yourself or your baby?", "How often do you have trouble sleeping even when the baby is resting?", "How often do you feel emotionally distant from your baby?", "How often do these feelings make it hard to take care of yourself?"],
        'Child': ["How often does your child seem sad or unhappy for long periods?", "How often does your child get very anxious about normal situations?", "How often does your child have tantrums that are hard to control?", "How often does your child have trouble concentrating on homework?", "How often does your child avoid school or friends they used to enjoy?", "How often does your child have sleep or appetite problems?", "How often does your child complain of pain without a clear medical reason?", "How often does your child seem very irritable or overly sensitive?", "How often do your child's emotions cause problems at school or home?", "How often do you feel your child is not coping well for their age?"]
    };

    let responseValues = {};

    function openQuiz(type) {
        responseValues = {};
        document.getElementById('quizTitle').innerText = type + " Assessment";
        const content = document.getElementById('quizContent');
        content.innerHTML = "";
        
        quizData[type].forEach((q, i) => {
            content.innerHTML += `
                <div style="margin-bottom: 25px; animation: slideIn 0.3s ease;">
                    <p style="font-weight: 600; margin-bottom: 12px; font-size: 16px;">${i+1}. ${q}</p>
                    <div class="options-group" data-q="${i}">
                        <button class="opt-btn" onclick="recordScore(${i}, 0, this)">Not at all</button>
                        <button class="opt-btn" onclick="recordScore(${i}, 1, this)">Sometimes</button>
                        <button class="opt-btn" onclick="recordScore(${i}, 2, this)">Often</button>
                        <button class="opt-btn" onclick="recordScore(${i}, 3, this)">Very often</button>
                    </div>
                </div>`;
        });
        
        content.innerHTML += `
            <button id="submitTestBtn" onclick="processResults('${type}')" style="background:var(--primary); color:white; border:none; width:100%; padding:16px; border-radius:12px; cursor:pointer; margin-top:20px; font-weight:bold; font-size: 16px;">
                Submit Assessment
            </button>
            <div id="innerResult" style="display:none; margin-top:20px;"></div>`;
        
        document.getElementById('quizOverlay').style.display = 'flex';
        document.querySelector('.quiz-modal').scrollTop = 0;
    }

    function recordScore(questionIndex, value, btn) {
        const group = btn.parentElement;
        group.querySelectorAll('.opt-btn').forEach(b => {
            b.style.background = 'white';
            b.style.color = 'var(--text)';
            b.style.borderColor = '#ddd';
        });
        btn.style.background = 'var(--primary)';
        btn.style.color = 'white';
        btn.style.borderColor = 'var(--primary)';
        responseValues[questionIndex] = value;
    }

    function closeQuiz() {
        document.getElementById('quizOverlay').style.display = 'none';
    }

    function processResults(type) {
        const resDiv = document.getElementById('innerResult');
        const totalQuestions = quizData[type].length;
        const answeredCount = Object.keys(responseValues).length;

        if (answeredCount < totalQuestions) {
            resDiv.style.display = "block";
            resDiv.innerHTML = `<p style="color:var(--danger); font-weight:bold; text-align:center;">Please answer all ${totalQuestions} questions.</p>`;
            return;
        }

        let totalScore = 0;
        for (let key in responseValues) { totalScore += responseValues[key]; }

        const solutions = {
            'Anxiety': "Try the 4-7-8 breathing technique, limit caffeine, and practice 'grounding' by naming 5 things you see.",
            'Depression': "Focus on 'Behavioral Activation'‚Äîtry to do one small task today, like a 5-minute walk or making your bed.",
            'ADHD': "Break big tasks into 10-minute chunks, use visual timers, and keep a 'distraction pad' for random thoughts.",
            'OCD': "Practice 'Exposure and Response Prevention' by delaying a ritual by just one minute at first.",
            'Postpartum': "Reach out to your doctor or a local support group. Prioritize rest when possible and accept help from loved ones.",
            'Child': "Ensure a consistent routine, use positive reinforcement, and create a 'calm-down corner' with soft textures."
        };

        const today = new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
        
        let level = "";
        let color = "#4f7f6a";
        if (totalScore <= 7) { level = "Low Signs"; color = "#4f7f6a"; }
        else if (totalScore <= 14) { level = "Mild Signs"; color = "#88a070"; }
        else if (totalScore <= 21) { level = "Moderate Signs"; color = "#d1a054"; }
        else { level = "High Signs"; color = "#d9534f"; }

        resDiv.style.display = "block";
        resDiv.innerHTML = `
            <div id="pdfContent" class="report-box">
                <h2 style="color:var(--primary); text-align:center; margin-bottom: 5px;">MindNest Wellness Report</h2>
                <p style="text-align:center; color:#666; font-size: 14px;">Date: ${today} | Category: ${type}</p>
                <hr style="margin: 20px 0; opacity: 0.1;">
                
                <div style="display:flex; align-items:center; justify-content:space-around; flex-wrap:wrap; margin:20px 0;">
                    <div style="width:140px; height: 140px;"><canvas id="resultChart"></canvas></div>
                    <div style="text-align:left;">
                        <p style="font-size: 14px; color: #888; margin: 0;">Total Score</p>
                        <h1 style="margin:0; color: ${color}">${totalScore} / 30</h1>
                        <p style="font-weight:bold; font-size: 18px; color: ${color}">${level}</p>
                    </div>
                </div>

                <div style="background:#f0f7f4; padding:20px; border-radius:15px; margin-top:10px;">
                    <h4 style="color:#4f7f6a; margin-bottom:8px;">üí° Coping Strategy:</h4>
                    <p style="font-size:15px; line-height:1.6; color: #444;">${solutions[type] || "Focus on self-care, consistent sleep, and reaching out to a trusted professional for a full evaluation."}</p>
                </div>

                <p style="font-size:11px; color:#aaa; margin-top:20px; font-style:italic; text-align: center;">
                    * This is a screening tool, not a medical diagnosis. If you are in crisis, please visit your nearest emergency room.
                </p>
                
                <button class="no-print" onclick="window.print()" style="width:100%; background:var(--primary); color:white; border:none; padding:14px; border-radius:10px; cursor:pointer; font-weight:bold; margin-top:15px;">
                    üì• Download Report (PDF)
                </button>
            </div>`;

        // Wait for DOM to update then render chart
        setTimeout(() => {
            const ctx = document.getElementById('resultChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [totalScore, 30 - totalScore],
                        backgroundColor: [color, '#f0f0f0'],
                        borderWidth: 0,
                        cutout: '70%'
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    plugins: { tooltip: { enabled: false } } 
                }
            });
            // Scroll to bottom of modal to see results
            document.querySelector('.quiz-modal').scrollTo({ top: 1000, behavior: 'smooth' });
        }, 100);
    }
</script>

</body>
</html>